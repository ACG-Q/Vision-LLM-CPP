name: ğŸ› ï¸ Multi-Platform Builder

on:
  workflow_dispatch:
    inputs:
      build_type:
        description: 'ç¼–è¯‘æ¨¡å¼'
        required: true
        default: 'Release'
        type: choice
        options: [Release, Debug]
      paddle_version:
        description: 'Paddle é¢„æµ‹åº“ç‰ˆæœ¬'
        default: '2.5.0'

jobs:
  # --- Android ç¼–è¯‘ä»»åŠ¡ ---
  build-android:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: ğŸ› ï¸ Setup NDK
        uses: nttld/setup-ndk@v1
        with:
          ndk-version: r25c

      - name: ğŸ“¦ Build Android (arm64-v8a)
        run: |
          chmod +x ./scripts/build_android.sh
          export ANDROID_NDK_HOME=$ANDROID_NDK
          ./scripts/build_android.sh ${{ github.event.inputs.build_type }}

      - name: ğŸ“¤ Upload Android Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ocr-android-lib
          path: build_android/lib*.so

  # --- Windows ç¼–è¯‘ä»»åŠ¡ ---
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: ğŸ› ï¸ Setup MSVC
        uses: ilammy/msvc-dev-cmd@v1

      - name: ğŸ“¦ Build Windows (x64)
        shell: powershell
        run: |
          ./scripts/build_windows.ps1 -BuildType ${{ github.event.inputs.build_type }}

      - name: ğŸ“¤ Upload Windows Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ocr-windows-dll
          path: build_win/Release/*.dll
